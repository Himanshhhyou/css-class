<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Smart Code Viewer</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" id="hljs-theme" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .sidebar {
      transition: transform 0.3s ease, opacity 0.3s ease;
    }
    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    .code-container {
  display: flex;
  width: 100%;
  overflow-x: auto; /* Enable horizontal scrolling */
}

pre {
  margin: 0;
  white-space: pre-wrap; /* Ensure code wraps properly on smaller screens */
  word-wrap: break-word; /* Prevent long lines from overflowing */
}

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .line-numbers {
      user-select: none;
      padding-right: 1rem;
      color: #6b7280;
      text-align: right;
    }
    .code-container {
      display: flex;
    }
    pre {
      margin: 0;
    }
    .settings-panel {
      transition: transform 0.3s ease;
    }
  </style>
</head>
<body class="min-h-screen bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300 font-sans">

  <header class="bg-blue-600 text-white p-4 flex justify-between items-center shadow-md">
    <h1 class="text-xl font-bold">Smart Code Viewer</h1>
    <button id="menu-btn" class="hamburger text-2xl md:hidden" onclick="toggleSidebar()">☰</button>
  </header>

  <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50" onclick="closeSidebar()"></div>

  <main class="flex flex-1">
    <aside id="sidebar" class="sidebar w-72 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 p-4 flex flex-col gap-4 fixed md:static top-0 left-0 h-full z-50 -translate-x-full md:translate-x-0">
      <input type="text" class="search-input p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Search files..." oninput="filterFiles(this.value)" />
      <div class="file-list flex flex-col gap-2 max-h-[70vh] overflow-y-auto">
        <div class="file-item p-2 bg-gray-100 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-blue-500 hover:text-white transition-colors" onclick="loadCode('01_inline.html')">01_inline.html</div>
        <div class="file-item p-2 bg-gray-100 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-blue-500 hover:text-white transition-colors" onclick="loadCode('02_internal.html')">02_internal.html</div>
        <div class="file-item p-2 bg-gray-100 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-blue-500 hover:text-white transition-colors" onclick="loadCode('03_external.html')">03_external.html</div>
        <div class="file-item p-2 bg-gray-100 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-blue-500 hover:text-white transition-colors" onclick="loadCode('03_style.css')">03_style.css</div>
        <div class="file-item p-2 bg-gray-100 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-blue-500 hover:text-white transition-colors" onclick="loadCode('04_specificity.html')">04_specificity.html</div>
        <div class="file-item p-2 bg-gray-100 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-blue-500 hover:text-white transition-colors" onclick="loadCode('04_specificity.css')">04_specificity.css</div>
      </div>
      <div class="flex flex-col gap-2 mt-auto">
        <button class="toggle-theme p-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors" onclick="toggleTheme()">Toggle Theme</button>
        <button class="settings-btn p-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors" onclick="toggleSettings()">Settings</button>
      </div>
    </aside>

    <section class="content flex-1 p-6 overflow-y-auto fade-in">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-semibold">Code Preview</h2>
        <div class="flex gap-2">
          <button id="copy-btn" class="p-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors" onclick="copyCode()">Copy Code</button>
          <button id="download-btn" class="p-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors" onclick="downloadCode()">Download</button>
        </div>
      </div>
      <div class="code-container bg-gray-800 rounded-lg">
        <pre class="line-numbers p-4"></pre>
        <pre><code id="code-block" class="language-none"></code></pre>
      </div>
    </section>

    <div id="settings-panel" class="settings-panel fixed top-0 right-0 h-full w-64 bg-white dark:bg-gray-800 p-4 border-l border-gray-200 dark:border-gray-700 transform translate-x-full transition-transform z-50">
      <h3 class="text-lg font-semibold mb-4">Settings</h3>
      <div class="flex flex-col gap-4">
        <label class="flex items-center gap-2">
          <input type="checkbox" id="line-numbers-toggle" checked onchange="toggleLineNumbers()">
          <span>Show Line Numbers</span>
        </label>
        <div>
          <label class="block mb-1">Font Size</label>
          <input type="range" id="font-size-slider" min="12" max="24" value="16" class="w-full" oninput="changeFontSize(this.value)">
        </div>
      </div>
      <button class="mt-4 p-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors" onclick="toggleSettings()">Close</button>
    </div>
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
  <script>
    let currentFilename = '';
    
    async function loadCode(filename) {
      try {
        const res = await fetch(filename);
        if (!res.ok) throw new Error("File not found");
        const text = await res.text();
        currentFilename = filename;

        const codeBlock = document.getElementById("code-block");
        const ext = filename.split('.').pop();
        codeBlock.className = `language-${ext === "css" ? "css" : "html"}`;
        codeBlock.textContent = text;
        hljs.highlightElement(codeBlock);
        
        updateLineNumbers(text);
        closeSidebar();
      } catch (err) {
        const codeBlock = document.getElementById("code-block");
        codeBlock.textContent = "⚠️ Error loading file: " + err.message;
        document.querySelector(".line-numbers").textContent = "";
      }
    }

    function updateLineNumbers(text) {
      const lineNumbers = document.querySelector(".line-numbers");
      if (!document.getElementById("line-numbers-toggle").checked) {
        lineNumbers.textContent = "";
        return;
      }
      const lines = text.split('\n').length;
      lineNumbers.textContent = Array.from({ length: lines }, (_, i) => i + 1).join('\n');
    }

    function toggleLineNumbers() {
      const codeBlock = document.getElementById("code-block");
      updateLineNumbers(codeBlock.textContent);
    }

    function changeFontSize(size) {
      document.getElementById("code-block").style.fontSize = `${size}px`;
      document.querySelector(".line-numbers").style.fontSize = `${size}px`;
    }

    function filterFiles(query) {
      const items = document.querySelectorAll(".file-item");
      items.forEach(item => {
        item.style.display = item.textContent.toLowerCase().includes(query.toLowerCase()) ? "block" : "none";
      });
    }

    function toggleTheme() {
      document.body.classList.toggle("dark");
      document.getElementById("sidebar").classList.toggle("dark");
      document.getElementById("settings-panel").classList.toggle("dark");

      const themeLink = document.getElementById("hljs-theme");
      themeLink.href = document.body.classList.contains("dark")
        ? "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css"
        : "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css";
    }

    function toggleSidebar() {
      document.getElementById("sidebar").classList.toggle("show");
      document.getElementById("sidebar").classList.toggle("-translate-x-full");
      document.getElementById("overlay").classList.toggle("hidden");
    }

    function closeSidebar() {
      document.getElementById("sidebar").classList.remove("show");
      document.getElementById("sidebar").classList.add("-translate-x-full");
      document.getElementById("overlay").classList.add("hidden");
    }

    function toggleSettings() {
      const panel = document.getElementById("settings-panel");
      panel.classList.toggle("translate-x-full");
    }

    function copyCode() {
      const code = document.getElementById("code-block").textContent;
      navigator.clipboard.writeText(code).then(() => {
        const btn = document.getElementById("copy-btn");
        btn.textContent = "Copied!";
        setTimeout(() => btn.textContent = "Copy Code", 2000);
      });
    }

    function downloadCode() {
      if (!currentFilename) return;
      const code = document.getElementById("code-block").textContent;
      const blob = new Blob([code], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = currentFilename;
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
